---
layout: soda.njk
title: Soda Tracker - Dashboard
permalink: /soda-tracker/
year: 2026
# Define your data here to make the table dynamic
soda_data:
  - name: Cherry Pepsi
    count: 2
    sugar: 84.0
    value: 0.20
  - name: Pepsi
    count: 4
    sugar: 168.0
    value: 0.40
---

<div class="header">
    <h1>During the <span class="year">{{ year }}</span> season, Liam Drank How Much??</h1>
    <p class="subtitle">The most important statistics in FRC</p>
</div>

<div class="stats-section">
    <h2>Overall Statistics</h2>
    <div class="stats-grid">
        <div class="stat-card">
            <h3>Total Cans</h3>
            <div class="stat-value" id="total-cans">0</div>
            <div class="stat-unit">cans consumed</div>
        </div>
        <div class="stat-card">
            <h3>Total Sugar</h3>
            <div class="stat-value" id="total-sugar">0</div>
            <div class="stat-unit">grams</div>
        </div>
        <div class="stat-card">
            <h3>Recycling Value</h3>
            <div class="stat-value" id="recycling-value">$0.00</div>
            <div class="stat-unit">earned back</div>
        </div>
    </div>
</div>

<div class="stats-section">
    <h2>Consumption by Type</h2>
    <table id="soda-table">
        <thead>
            <tr>
                <th>Soda Type</th>
                <th>Cans</th>
                <th>Sugar (g)</th>
                <th>Recycling Value</th>
            </tr>
        </thead>
        <tbody>
            {# Nunjucks Loop: Generates rows based on the data in Front Matter #}
            {% for soda in soda_data %}
            <tr>
                <td class="soda-name">{{ soda.name }}</td>
                <td class="number-cell">{{ soda.count }}</td>
                <td class="number-cell">{{ soda.sugar }}</td>
                <td class="number-cell">${{ soda.value }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="stats-section">
    <h2>Daily Consumption Trend</h2>
    <div class="chart-container">
        <canvas id="sodaChart"></canvas>
    </div>
    <div class="chart-controls">
        <button class="time-range-btn active" data-range="week">Last 7 Days</button>
        <button class="time-range-btn" data-range="month">Last 30 Days</button>
        <button class="time-range-btn" data-range="season">Full Season</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script>
    // --- STATISTICS LOGIC ---
    // This runs on the client side to sum up the table rows generated by Nunjucks
    function updateOverallStatistics() {
        const tableRows = document.querySelectorAll('#soda-table tbody tr');
        let totalCans = 0;
        let totalSugar = 0;
        let totalRecyclingValue = 0;

        tableRows.forEach(row => {
            const cells = row.cells;
            // The logic matches your original structure:
            // cells[1] = count, cells[2] = sugar, cells[3] = value ($)
            
            const cans = parseInt(cells[1].textContent) || 0;
            const sugar = parseFloat(cells[2].textContent) || 0;
            const recycling = parseFloat(cells[3].textContent.replace("$", "")) || 0;

            totalCans += cans;
            totalSugar += sugar;
            totalRecyclingValue += recycling;
        });

        document.getElementById("total-cans").textContent = totalCans;
        document.getElementById("total-sugar").textContent = totalSugar.toFixed(0);
        document.getElementById("recycling-value").textContent = "$" + totalRecyclingValue.toFixed(2);
    }

    // --- CHART LOGIC ---
    const chartData = {
        week: {
            labels: ['Jan 10', 'Jan 11', 'Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16'],
            data: [2, 0, 0, 2, 0, 1, 1]
        },
        month: {
            labels: ['Jan 10', 'Jan 11', 'Jan 12', 'Jan 13', 'Jan 14', 'Jan 15', 'Jan 16'],
            data: [2, 0, 0, 2, 0, 1, 1]
        },
        season: {
            labels: ['Week 1'],
            data: [6]
        }
    };

    let currentChart = null;

    function createChart(range) {
        const ctx = document.getElementById('sodaChart').getContext('2d');
        if (currentChart) currentChart.destroy();

        const data = chartData[range];

        currentChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.labels,
                datasets: [{
                    label: 'Cans of Soda',
                    data: data.data,
                    borderColor: '#e67e22',
                    backgroundColor: 'rgba(230, 126, 34, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointBackgroundColor: '#e67e22',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 6,
                    pointHoverRadius: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(44, 62, 80, 0.95)',
                        callbacks: {
                            label: function(context) {
                                return context.parsed.y === 1 ? '1 can' : context.parsed.y + ' cans';
                            }
                        }
                    }
                },
                scales: {
                    y: { beginAtZero: true, ticks: { stepSize: 1 } },
                    x: { grid: { display: false } }
                }
            }
        });
    }

    document.addEventListener('DOMContentLoaded', function() {
        updateOverallStatistics();
        createChart('week');
    });

    document.querySelectorAll('.time-range-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.time-range-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            createChart(this.dataset.range);
        });
    });
</script>